<div *ngIf="loading" class="loading-overlay">
  <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
    <span class="sr-only">Cargando...</span>
  </div>
</div>
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="page-title-box d-sm-flex align-items-center justify-content-between">
        <h4 class="mb-sm-0">{{titulopant}}</h4>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <div class="row ">
            <div class="col-xxl-2 col-md-6">
              <div>
                <label for="lic_fecini" class="form-label">DESDE</label>
                <input type="date" class="form-control form-control-sm" id="lic_fecini" [(ngModel)]="lic_fecini">
              </div>
            </div>
            <div class="col-xxl-2 col-md-6">
              <div>
                <label for="lic_fecfin" class="form-label">HASTA</label>
                <input type="date" class="form-control form-control-sm" id="lic_fecfin" [(ngModel)]="lic_fecfin">
              </div>
            </div>
            <div class="col-xxl-5 col-md-6">
              <div>
                <label for="esl_id" class="form-label">ESTADO</label>
                <ng-select class="mayus" [(ngModel)]="esl_id">
                    <ng-option value="0">Seleccionar Estado</ng-option>
                    <ng-option *ngFor="let item of dataEstadoLibro" [value]="item.esl_id">{{item.esl_descri}}</ng-option>
                </ng-select>
              </div>
            </div>
            <div class="col-xxl-3 col-md-6">
              <div class="card-header align-items-center d-flex" style="justify-content: end; padding-right: 0px;">
                <div class="d-flex gap-2">
                  <button type="button" class="btn btn-primary btn-outline-primary btn-sm text-white d-flex justify-content-center align-items-center gap-1" id="buscar" (click)="loadDataProceso()">
                    <i class="ri-search-line"></i> BUSCAR </button>
                  <button *ngIf="btnPerm.excel" type="button" class="btn btn-success btn-sm text-white d-flex justify-content-center align-items-center gap-1" id="descargaExcel" (click)="descargaExcel()" [disabled]="!exportarHabilitado">
                    <i class="ri-file-excel-2-line"></i> EXPORTAR </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xl-12">
      <div class="card">
        <div class="card-body p-0">
          <div class="dt-mobile-scroll" id="tablaDataProceso">
            <table class="table align-middle table-nowrap mb-0 table--wide" datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger">
              <thead>
                <tr style="text-align: center;">
                  <th scope="col" data-priority="1">NÂ° LIBRO</th>
                  <th scope="col" data-priority="2">FECHA</th>
                  <th scope="col" data-priority="3">NOMBRE DEL FEDATARIO</th>
                  <th scope="col" data-priority="4">ESTADO</th>
                  <th scope="col" data-priority="5">ACCIONES</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of dataLibro" style="text-align: center;">
                  <td scope="row">
                    <p class="fw-bold">{{item.lic_numero}}</p>
                  </td>
                  <td>{{getFechaFormateada(item.lic_fecemi)}}</td>
                  <td>{{item.fed_nomcom}}</td>
                  <td>{{item.lic_estado}}</td>
                  <td>
                    <div class="dropdown">
                      <button type="button" class="btn btn-outline-primary btn-icon btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ri-align-justify"></i></button>
                        <ul class="dropdown-menu dropdown-menu-end" [attr.data-bs-container]="'body'">
                          <li *ngIf="item.chk_bottra"><a class="dropdown-item edit-item-btn" (click)="getIdButton(1, item)">TRAMITES</a></li>
                          <li *ngIf="item.chk_botcer"><a class="dropdown-item edit-item-btn" (click)="getIdButton(3, item)">CERRAR</a></li>
                        </ul>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #ImportFileModal>
  <div class="modal-header">
    <h5 class="modal-title">Importar archivo</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modalRef?.hide()"></button>
  </div>
  <div class="modal-body">
    <div class="mb-3">
      <label for="fileInput" class="form-label">Seleccione un archivo</label>
      <input type="file" id="fileInput" (change)="onFileSelected($event)" class="form-control" accept=".xls,.xlsx" />
    </div>
    <div *ngIf="selectedFileName" class="mb-2">
      <strong>Archivo seleccionado:</strong> {{selectedFileName}}
    </div>
    <div *ngIf="uploading" class="mb-2">
      <div class="spinner-border text-primary" style="width: 1.5rem; height: 1.5rem;" role="status"></div>
      <span class="ms-2">Subiendo...</span>
    </div>
    <div *ngIf="uploadResult" class="alert" [ngClass]="{'alert-success': uploadSuccess, 'alert-danger': !uploadSuccess}">
      {{uploadResult}}
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modalRef?.hide()">Cerrar</button>
    <button type="button" class="btn btn-primary" [disabled]="!fileToUpload || uploading" (click)="uploadFile()">Procesar</button>
  </div>
</ng-template>